# 用古诗词做Masked Language Model任务

这是一个用Google的BERT模型对古诗词做Masked Language Model(MLM)任务的程序。随机遮住句子中的几个字/词，让程序预测被遮住的字/词，这就是MLM任务。程序使用了本人编写的[simplebert](https://github.com/gaolichen/simplebert)模块来加载BERT模型。

## 主要功能
- 使用[中华古诗词数据库](https://github.com/chinese-poetry/chinese-poetry)的唐诗和宋词进行训练
- 用90%的数据训练，10%的数据验证
- 在验证数据中选取100个句子，每个句子随机遮住一个字，比较训练前后程序的准确率

## 运行方法
- 需在GPU环境下运行
- 安装package： `pip install simplerbert zhconv`
- 在本目录的上一层目录，运行`python -m masked_language_model.train`


## 运行结果
对每个句子，程序给出两个概率最大的预测，其中有一个正确答案，则为预测成功，否则为预测失败。训练前准确率为26%。部分输出结果：

```shell
accuracy = 0.26
correct predicts:
('掩卷勿重陈，恸哭伤__气。', '人') 	prediction:  [('人', 0.07060227543115616), ('元', 0.039788197726011276)]
('幽讨平__如此少，清闲今日许谁知。', '生') 	prediction:  [('生', 0.7154790759086609), ('时', 0.05146220326423645)]
('稽首__慈，如大地载。', '大') 	prediction:  [('慈', 0.13907204568386078), ('大', 0.12231048196554184)]
('苍苔复阁连荒草，乔__参云挂老藤。', '木') 	prediction:  [('木', 0.32727381587028503), ('树', 0.14084425568580627)]
('频岁驱驰行万__，还家幸矣敢言疲。', '里') 	prediction:  [('里', 0.9636253118515015), ('载', 0.002551188925281167)]
('海燕衔泥欲作__，空堂无人却飞去。', '巢') 	prediction:  [('巢', 0.2526654005050659), ('蝶', 0.06980397552251816)]
('网丝旧画昔尝见，不意人间今__之。', '见') 	prediction:  [('有', 0.21323463320732117), ('见', 0.05860944837331772)]
('__肝甘虎口，孝骨委蛟涎。', '忠') 	prediction:  [('忠', 0.13395336270332336), ('慈', 0.12003300338983536)]
('婆娑风月隅，__窕溪山宅。', '窈') 	prediction:  [('窈', 0.9980087876319885), ('窕', 0.0016017754096537828)]
('夕阳漏影射疏林，三两人__桑柘阴。', '家') 	prediction:  [('家', 0.09506651014089584), ('在', 0.04065539315342903)]
('昭然贯日诚，屹尔回__力。', '天') 	prediction:  [('天', 0.43667635321617126), ('日', 0.13621459901332855)]
('他年浪许曾窥豹，此__谁堪与濯缨。', '日') 	prediction:  [('日', 0.11555971205234528), ('时', 0.1034502312541008)]
...

incorrect predicts:
('夔子山高峡天阔，骚人宅近__肠悲。', '刚') 	prediction:  [('断', 0.47469690442085266), ('肝', 0.0511016882956028)]
('痴儿呵冻为__赋，费尽壶中墨客卿。', '渠') 	prediction:  [('诗', 0.2743428647518158), ('君', 0.1260828971862793)]
('相茵朝以登，胡骑__可逐。', '夕') 	prediction:  [('不', 0.4636416435241699), ('未', 0.06769382208585739)]
('平生事靖退，墨__自要津。', '头') 	prediction:  [('客', 0.21530413627624512), ('迹', 0.07961680740118027)]
('潮满江津猿鸟啼，荆夫__语飞蛮桨。', '楚') 	prediction:  [('无', 0.21794617176055908), ('不', 0.08835069835186005)]
('维时南风薰，木叶晃__碧。', '繁') 	prediction:  [('摇', 0.07832323759794235), ('清', 0.06156591325998306)]
('吴儿便操舟，衣服__楚制。', '皆') 	prediction:  [('为', 0.06068611145019531), ('由', 0.042332231998443604)]
('一去别金__，飞沈失相从。', '匣') 	prediction:  [('陵', 0.09409421682357788), ('城', 0.037444017827510834)]
('__典久传祠太乙，竺坟亦说会夫人。', '汉') 	prediction:  [('经', 0.06828376650810242), ('祭', 0.030463244765996933)]
('春色__梅岭，秋声后桂林。', '先') 	prediction:  [('前', 0.08086535334587097), ('来', 0.04614410921931267)]
('谓天子__，感于人神。', '孝') 	prediction:  [('者', 0.1080205962061882), ('也', 0.08352025598287582)]
('__边瀑雪寒侵梦，涧底笙箫冷韵腔。', '崖') 	prediction:  [('溪', 0.16582469642162323), ('山', 0.13614335656166077)]
('冻醪有力__推挽，春茗无端苦破除。', '勤') 	prediction:  [('难', 0.25148308277130127), ('无', 0.0470694899559021)]
('__学一门要精密，时文大病在尖新。', '理') 	prediction:  [('国', 0.1439046561717987), ('文', 0.11527226865291595)]
('擘破宝公面皮，德云无处__避。', '回') 	prediction:  [('躲', 0.46249890327453613), ('可', 0.2357885092496872)]

```

训练3个epoch后，正确率提高为44%。部分输出结果：

```shell
accuracy = 0.44
correct predicts:
('幽讨平__如此少，清闲今日许谁知。', '生') 	prediction:  [('生', 0.9553178548812866), ('时', 0.03859643638134003)]
('相茵朝以登，胡骑__可逐。', '夕') 	prediction:  [('夜', 0.15661050379276276), ('夕', 0.15394945442676544)]
('吴儿便操舟，衣服__楚制。', '皆') 	prediction:  [('皆', 0.08485011756420135), ('为', 0.07700314372777939)]
('稽首__慈，如大地载。', '大') 	prediction:  [('大', 0.4974978566169739), ('慈', 0.08413518220186234)]
('苍苔复阁连荒草，乔__参云挂老藤。', '木') 	prediction:  [('木', 0.959535539150238), ('树', 0.017344415187835693)]
('__典久传祠太乙，竺坟亦说会夫人。', '汉') 	prediction:  [('汉', 0.12053366750478745), ('禹', 0.06589178740978241)]
('频岁驱驰行万__，还家幸矣敢言疲。', '里') 	prediction:  [('里', 0.9867385625839233), ('马', 0.0009648468694649637)]
('春色__梅岭，秋声后桂林。', '先') 	prediction:  [('前', 0.2856656312942505), ('先', 0.2836872637271881)]
('海燕衔泥欲作__，空堂无人却飞去。', '巢') 	prediction:  [('巢', 0.16221989691257477), ('群', 0.11654902994632721)]
('网丝旧画昔尝见，不意人间今__之。', '见') 	prediction:  [('见', 0.5492773652076721), ('有', 0.16833272576332092)]
('__肝甘虎口，孝骨委蛟涎。', '忠') 	prediction:  [('忠', 0.184464231133461), ('慈', 0.0752253383398056)]
('婆娑风月隅，__窕溪山宅。', '窈') 	prediction:  [('窈', 0.9930623173713684), ('缥', 0.0010974133620038629)]
('几见__鸟啼黄叶，聚薰入奏雪飞絮。', '幽') 	prediction:  [('幽', 0.10173739492893219), ('白', 0.09621056914329529)]
('__脸晚来红拂掠，未妨萧瑟却风流。', '醉') 	prediction:  [('醉', 0.11279667913913727), ('笑', 0.08484535664319992)]
('夕阳漏影射疏林，三两人__桑柘阴。', '家') 	prediction:  [('家', 0.6924311518669128), ('归', 0.1617496907711029)]
...

incorrect predicts:
('夔子山高峡天阔，骚人宅近__肠悲。', '刚') 	prediction:  [('断', 0.6204995512962341), ('离', 0.054959289729595184)]
('掩卷勿重陈，恸哭伤__气。', '人') 	prediction:  [('士', 0.12313748151063919), ('志', 0.07649099081754684)]
('痴儿呵冻为__赋，费尽壶中墨客卿。', '渠') 	prediction:  [('君', 0.5099825263023376), ('谁', 0.0938527062535286)]
('平生事靖退，墨__自要津。', '头') 	prediction:  [('客', 0.07134437561035156), ('墨', 0.06212985888123512)]
('潮满江津猿鸟啼，荆夫__语飞蛮桨。', '楚') 	prediction:  [('无', 0.17239007353782654), ('不', 0.12687981128692627)]
('维时南风薰，木叶晃__碧。', '繁') 	prediction:  [('空', 0.13676896691322327), ('金', 0.13056747615337372)]
('一去别金__，飞沈失相从。', '匣') 	prediction:  [('闺', 0.10392197966575623), ('门', 0.08899002522230148)]
('谓天子__，感于人神。', '孝') 	prediction:  [('心', 0.07555984705686569), ('命', 0.043520599603652954)]
('__边瀑雪寒侵梦，涧底笙箫冷韵腔。', '崖') 	prediction:  [('溪', 0.12879487872123718), ('天', 0.11780868470668793)]
('冻醪有力__推挽，春茗无端苦破除。', '勤') 	prediction:  [('难', 0.28537923097610474), ('劳', 0.06873934715986252)]
('__学一门要精密，时文大病在尖新。', '理') 	prediction:  [('国', 0.10516408085823059), ('道', 0.06514286249876022)]
('擘破宝公面皮，德云无处__避。', '回') 	prediction:  [('可', 0.5083704590797424), ('逃', 0.18189489841461182)]
('知君元日__鹓行，双观云边耸百常。', '趁') 	prediction:  [('解', 0.023643868044018745), ('一', 0.01976126618683338)]
('须臾各霁止，太虚__寥廓。', '自') 	prediction:  [('空', 0.04324490576982498), ('入', 0.02411290630698204)]

```


